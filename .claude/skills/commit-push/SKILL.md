---
name: commit-push
description: 手動でステージングされたファイルをコミットしてプッシュします。コードの変更をリモートリポジトリに反映したい場合に使用してください。
allowed-tools:
  - Bash
  - Read
  - AskUserQuestion
---

# コミット＆プッシュスキル

このスキルは、手動でステージングされた変更をコミットしてプッシュまで実行します。

**重要：このスキルは`git add`を実行しません。事前に手動でファイルをステージングしてください。**

## 実行手順

### 1. 現状確認

以下のコマンドを並列実行して現在の状態を確認する：

- `git status`: 変更されたファイルとステージング状態を確認
- `git diff --cached`: ステージされた変更内容を確認
- `git log --oneline -5`: 最近のコミットメッセージスタイルを確認

### 2. コミットメッセージの生成

Run /create-commit-message to generate a commit message from staged changes.

### 3. コミットの承諾

コミットメッセージを作成したら、以下の手順でユーザーに承諾を得る：

1. **まず、作成したコミットメッセージをテキストとして出力する**（コードブロックで表示）
2. その後、`AskUserQuestion`ツールで承諾を求める：
   - 質問: "このコミットメッセージでコミットしていいですか？"
   - 選択肢:
     - "はい、コミットする" → コミットを実行
     - "いいえ、コミットしない" → コミットせずに終了

### 4. コミット

```bash
git commit -m "$(cat <<'EOF'
[生成したコミットメッセージ]
EOF
)"
```

### 5. プッシュ

ユーザーが承諾した場合のみ、以下を実行：

```bash
git push
```

### 6. エラーハンドリング

- コミットがpre-commitフックで失敗した場合：フックが自動修正したファイルを含めて**新しいコミット**を作成（amendは使用しない）
- プッシュが失敗した場合（リモートに新しいコミットがある場合）：`git pull --rebase`を実行してから再度プッシュ

### 7. プランファイルのクリーンアップ

プッシュが成功したら、`.claude/plans/`ディレクトリを確認し、関連するプランファイルを削除する。

1. **プランファイルの確認**
   - `.claude/plans/`内の全`.md`ファイルを取得
   - ファイルが存在しない場合はスキップ

2. **コミット履歴の取得**
   - `git log --name-only --oneline -10`で最近10件のコミットと変更ファイルを取得
   - プランの完了判定に使用する

3. **関連性の判定**

   各プランファイルについて：
   - プランの内容を読み込む
   - プランに記載された「修正するファイル」「対象コンポーネント」をリストアップ
   - **今回のコミット**と**最近10件のコミット履歴**の両方を参照
   - プランで記述されていた実装が完了しているか判定

   判定基準：
   - プランで記載された「修正するファイル」が今回または最近のコミットに含まれているか
   - プランに複数のタスクがある場合、全てのタスクが完了しているか
   - プランの目的が達成されているか

   判定例：
   - プランに「Card.tsx、Input.tsx、List.txを修正」と記載
   - 最近のコミット履歴を確認: Card.tsx（2件前）、Input.tsx（1件前）、List.tsx（今回）
   - → 全て完了していると判定し、プランファイルを削除

4. **削除の実行**
   - 関連があると判定したプランファイルを削除
   - 削除したファイル名をユーザーに報告

## 注意事項

- **このスキルは`git add`を実行しません**：ファイルのステージングは事前に手動で行ってください
- .envや認証情報ファイルなど、秘密情報を含むファイルはコミットしない
- コミット前に変更内容を確認し、意図しないファイルが含まれていないかチェックする
- NEVER use `git commit --amend` unless explicitly requested by user
- NEVER skip hooks with --no-verify unless explicitly requested by user
