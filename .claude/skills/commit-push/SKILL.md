---
name: commit-push
description: git add、commit、pushを一連の流れで実行します。コードの変更をリモートリポジトリに反映したい場合に使用してください。
allowed-tools:
  - Bash
  - Read
  - AskUserQuestion
---

# コミット＆プッシュスキル

このスキルは、変更をステージング、コミット、プッシュまで一連の流れで実行します。

## 実行手順

### 1. 現状確認

以下のコマンドを並列実行して現在の状態を確認する：

- `git status`: 変更されたファイルとステージング状態を確認
- `git diff --cached`: ステージされた変更内容を確認
- `git log --oneline -5`: 最近のコミットメッセージスタイルを確認

### 2. コミットメッセージの生成

以下の形式でコミットメッセージを作成する：

```
[タイトル行]

[何ができるようになったか、または何が改善されたか]

変更内容：
- [変更1]
- [変更2]
- [変更3]

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
```

**重要なポイント：**

- タイトル行は簡潔に（50文字以内推奨）
- 「何ができるようになったか」を必ず記述する
  - 新機能：「〇〇機能により、△△が可能になりました」
  - バグ修正：「〇〇の修正により、△△が正しく動作するようになりました」
  - リファクタリング：「〇〇のリファクタリングにより、△△が改善されました」
- 変更内容は箇条書きで具体的に記述
- 全て日本語で記述（プロジェクトのCLAUDE.mdに準拠）

### 3. コミットの承諾

コミットメッセージを作成したら、以下の手順でユーザーに承諾を得る：

1. **まず、作成したコミットメッセージをテキストとして出力する**（コードブロックで表示）
2. その後、`AskUserQuestion`ツールで承諾を求める：
   - 質問: "このコミットメッセージでコミットしていいですか？"
   - 選択肢:
     - "はい、コミットする" → コミットを実行
     - "いいえ、コミットしない" → コミットせずに終了

### 4. コミット

```bash
git commit -m "$(cat <<'EOF'
[生成したコミットメッセージ]
EOF
)"
```

### 5. プッシュ

ユーザーが承諾した場合のみ、以下を実行：

```bash
git push
```

### 6. エラーハンドリング

- コミットがpre-commitフックで失敗した場合：フックが自動修正したファイルを含めて**新しいコミット**を作成（amendは使用しない）
- プッシュが失敗した場合（リモートに新しいコミットがある場合）：`git pull --rebase`を実行してから再度プッシュ

### 7. プランファイルのクリーンアップ

プッシュが成功したら、`.claude/plans/`ディレクトリを確認し、関連するプランファイルを削除する。

1. **プランファイルの確認**
   - `.claude/plans/`内の全`.md`ファイルを取得
   - ファイルが存在しない場合はスキップ

2. **関連性の判定**

   各プランファイルについて：
   - プランの内容を読み込む
   - 今回のコミット内容（変更ファイル、コミットメッセージ）と比較
   - プランで記述されていた実装が今回のコミットで完了したか判定

   判定基準：
   - プランで記載された「修正するファイル」が今回のコミットに含まれているか
   - コミットメッセージがプランの内容と一致しているか
   - プランの目的が今回のコミットで達成されているか

3. **削除の実行**
   - 関連があると判定したプランファイルを削除
   - 削除したファイル名をユーザーに報告

## 注意事項

- .envや認証情報ファイルなど、秘密情報を含むファイルはコミットしない
- コミット前に変更内容を確認し、意図しないファイルが含まれていないかチェックする
- NEVER use `git commit --amend` unless explicitly requested by user
- NEVER skip hooks with --no-verify unless explicitly requested by user
